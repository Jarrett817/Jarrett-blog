function G(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}const ae=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Q=e=>e.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,n,i,s){return"#"+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)+("0"+Number(s).toString(16)).substr(-2)}),ie=function(e,t){if(t=t||this.nodeData,t.id===e)return t;if(t.children&&t.children.length)for(let n=0;n<t.children.length;n++){const i=ie(e,t.children[n]);if(i)return i}else return null},w=(e,t)=>{if(e.parent=t,e.children)for(let n=0;n<e.children.length;n++)w(e.children[n],e)};function se(e){if(e.id=F(),e.children)for(let t=0;t<e.children.length;t++)se(e.children[t])}const de=(e,t)=>{var n=Date.now();return function(){var i=this,s=arguments,o=Date.now();o-n>=t&&(e.apply(i,s),n=Date.now())}};function oe(e,t,n,i){const s=i-t,o=e-n;let l=Math.atan(Math.abs(s)/Math.abs(o))/3.14*180;o<0&&s>0&&(l=180-l),o<0&&s<0&&(l=180+l),o>0&&s<0&&(l=360-l);const c=20,r=30;var g=l+r;const m=l-r;return{x1:n+Math.cos(Math.PI*g/180)*c,y1:i-Math.sin(Math.PI*g/180)*c,x2:n+Math.cos(Math.PI*m/180)*c,y2:i-Math.sin(Math.PI*m/180)*c}}function W(e,t,n){let i,s;const o=(e.cy-n)/(t-e.cx);return o>e.h/e.w||o<-e.h/e.w?e.cy-n<0?(i=e.cx-e.h/2/o,s=e.cy+e.h/2):(i=e.cx+e.h/2/o,s=e.cy-e.h/2):e.cx-t<0?(i=e.cx+e.w/2,s=e.cy-e.w*o/2):(i=e.cx-e.w/2,s=e.cy+e.w*o/2),{x:i,y:s}}function X(e,t,n){let i,s;const o=(e.cy-n)/(t-e.cx);return o>e.h/e.w||o<-e.h/e.w?e.cy-n<0?(i=e.cx-e.h/2/o,s=e.cy+e.h/2):(i=e.cx+e.h/2/o,s=e.cy-e.h/2):e.cx-t<0?(i=e.cx+e.w/2,s=e.cy-e.w*o/2):(i=e.cx-e.w/2,s=e.cy+e.w*o/2),{x:i,y:s}}function F(){return(new Date().getTime().toString(16)+Math.random().toString(16).substr(2)).substr(2,16)}function he(){const e=F();return{topic:this.newTopicName||"new node",id:e}}function ue(e,t){let n=!0;for(;t.parent;){if(t.parent===e){n=!1;break}t=t.parent}return n}function fe(e){const t=e.parent.children,n=t.indexOf(e),i=t[n];n===0?(t[n]=t[t.length-1],t[t.length-1]=i):(t[n]=t[n-1],t[n-1]=i)}function pe(e){const t=e.parent.children,n=t.indexOf(e),i=t[n];n===t.length-1?(t[n]=t[0],t[0]=i):(t[n]=t[n+1],t[n+1]=i)}function Y(e){const t=e.parent.children,n=t.indexOf(e);return t.splice(n,1),t.length}function me(e,t){const n=e.parent.children,i=n.indexOf(e);n.splice(i+1,0,t)}function ge(e,t){const n=e.parent.children,i=n.indexOf(e);n.splice(i,0,t)}function Ne(e,t){const n=e.parent.children,i=n.indexOf(e);n[i]=t,t.children=[e]}function be(e,t){Y(e),t.children?t.children.push(e):t.children=[e]}function ve(e,t){Y(e);const n=t.parent.children;let i=0;for(let s=0;s<n.length;s++)if(n[s]===t){i=s;break}n.splice(i,0,e)}function ye(e,t){Y(e);const n=t.parent.children;let i=0;for(let s=0;s<n.length;s++)if(n[s]===t){i=s;break}n.splice(i+1,0,e)}const I={afterMoving:!1,mousedown:!1,lastX:null,lastY:null,onMove(e,t){if(this.mousedown){if(this.afterMoving=!0,!this.lastX){this.lastX=e.pageX,this.lastY=e.pageY;return}const n=this.lastX-e.pageX,i=this.lastY-e.pageY;t.scrollTo(t.scrollLeft+n,t.scrollTop+i),this.lastX=e.pageX,this.lastY=e.pageY}},clear(){this.afterMoving=!1,this.mousedown=!1,this.lastX=null,this.lastY=null}};function B(e){this.dom=e,this.mousedown=!1,this.lastX=null,this.lastY=null}B.prototype.init=function(e,t){this.handleMouseMove=n=>{if(n.stopPropagation(),this.mousedown){if(!this.lastX){this.lastX=n.pageX,this.lastY=n.pageY;return}const i=this.lastX-n.pageX,s=this.lastY-n.pageY;t(i,s),this.lastX=n.pageX,this.lastY=n.pageY}},this.handleMouseDown=n=>{n.stopPropagation(),this.mousedown=!0},this.handleClear=n=>{n.stopPropagation(),this.clear()},e.addEventListener("mousemove",this.handleMouseMove),e.addEventListener("mouseleave",this.handleClear),e.addEventListener("mouseup",this.handleClear),this.dom.addEventListener("mousedown",this.handleMouseDown)};B.prototype.destory=function(e){e.removeEventListener("mousemove",this.handleMouseMove),e.removeEventListener("mouseleave",this.handleClear),e.removeEventListener("mouseup",this.handleClear),this.dom.removeEventListener("mousedown",this.handleMouseDown)};B.prototype.clear=function(){this.mousedown=!1,this.lastX=null,this.lastY=null};const $=document,E=(e,t)=>(t?t.mindElixirBox:$).querySelector(`[data-nodeid=me${e}]`),_=function(e,t){if(e.textContent=t.topic,t.style&&(e.style.color=t.style.color||"inherit",e.style.background=t.style.background||"inherit",e.style.fontSize=t.style.fontSize+"px",e.style.fontWeight=t.style.fontWeight||"normal"),t.hyperLink){const n=$.createElement("a");n.className="hyper-link",n.target="_blank",n.innerText="🔗",n.href=t.hyperLink,e.appendChild(n),e.linkContainer=n,console.log(n)}else e.linkContainer&&(e.linkContainer.remove(),e.linkContainer=null);if(t.icons&&t.icons.length){const n=$.createElement("span");n.className="icons",n.innerHTML=t.icons.map(i=>`<span>${G(i)}</span>`).join(""),e.appendChild(n)}if(t.tags&&t.tags.length){const n=$.createElement("div");n.className="tags",n.innerHTML=t.tags.map(i=>`<span>${G(i)}</span>`).join(""),e.appendChild(n)}},xe=function(e,t){const n=$.createElement("GRP"),i=this.createTop(e);if(n.appendChild(i),!t&&e.children&&e.children.length>0&&(i.appendChild(V(e.expanded)),e.expanded!==!1)){const s=this.createChildren(e.children);n.appendChild(s)}return{grp:n,top:i}},Ce=function(e){const t=$.createElement("t"),n=this.createTopic(e);return _(n,e),t.appendChild(n),t},ke=function(e){const t=$.createElement("tpc");return t.nodeObj=e,t.dataset.nodeid="me"+e.id,t.draggable=this.draggable,t};function Ee(e){const t=$.createRange();t.selectNodeContents(e);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))}function Le(e){if(console.time("createInputDiv"),!e)return;let t=$.createElement("div");const n=e.childNodes[0].textContent;e.appendChild(t),t.id="input-box",t.textContent=n,t.contentEditable="true",t.spellcheck=!1,t.style.cssText=`min-width:${e.offsetWidth-8}px;`,this.direction===0&&(t.style.right="0"),t.focus(),Ee(t),this.inputDiv=t,this.bus.fire("operation",{name:"beginEdit",obj:e.nodeObj}),t.addEventListener("keydown",i=>{i.stopPropagation();const s=i.key;if(s==="Enter"||s==="Tab"){if(i.shiftKey)return;i.preventDefault(),this.inputDiv.blur(),this.map.focus()}}),t.addEventListener("blur",()=>{if(!t)return;const i=e.nodeObj,s=t.textContent.trim();console.log(s),s===""?i.topic=n:i.topic=s,t.remove(),this.inputDiv=t=null,s!==n&&(e.childNodes[0].textContent=i.topic,this.linkDiv(),this.bus.fire("operation",{name:"finishEdit",obj:i,origin:n}))}),console.timeEnd("createInputDiv")}const V=function(e){const t=$.createElement("epd");return t.expanded=e!==!1,t.className=e!==!1?"minus":"",t};function $e(e,t,n){let i;t?i=t:i=$.createElement("children");for(let s=0;s<e.length;s++){const o=e[s],l=$.createElement("GRP");n===0?l.className="lhs":n===1?l.className="rhs":n===2&&(o.direction===0?l.className="lhs":o.direction===1&&(l.className="rhs"));const c=this.createTop(o);if(o.children&&o.children.length>0){if(c.appendChild(V(o.expanded)),l.appendChild(c),o.expanded!==!1){const r=this.createChildren(o.children);l.appendChild(r)}}else l.appendChild(c);i.appendChild(l)}return i}function we(){console.time("layout"),this.root.innerHTML="",this.box.innerHTML="";const e=this.createTopic(this.nodeData);_(e,this.nodeData),e.draggable=!1,this.root.appendChild(e);const t=this.nodeData.children;if(!(!t||t.length===0)){if(this.direction===2){let n=0,i=0;t.map(s=>{s.direction===void 0?n<=i?(s.direction=0,n+=1):(s.direction=1,i+=1):s.direction===0?n+=1:i+=1})}this.createChildren(this.nodeData.children,this.box,this.direction),console.timeEnd("layout")}}const P=document,D="http://www.w3.org/2000/svg",Te=function(e){const t=P.createElementNS(D,"path");return t.setAttribute("d",e),t.setAttribute("stroke","#666"),t.setAttribute("fill","none"),t.setAttribute("stroke-width","2"),t},q=function(e){const t=P.createElementNS(D,"svg");return t.setAttribute("class",e),t},ee=function(e,t,n,i){const s=P.createElementNS(D,"line");return s.setAttribute("x1",e),s.setAttribute("y1",t),s.setAttribute("x2",n),s.setAttribute("y2",i),s.setAttribute("stroke","#bbb"),s.setAttribute("fill","none"),s.setAttribute("stroke-width","2"),s},Se=function(e){const t=P.createElementNS(D,"path");return t.setAttribute("d",e),t.setAttribute("stroke","#555"),t.setAttribute("fill","none"),t.setAttribute("stroke-linecap","square"),t.setAttribute("stroke-width","1"),t},Me=function(e,t){const n=P.createElementNS(D,"g"),i=P.createElementNS(D,"path"),s=P.createElementNS(D,"path");return s.setAttribute("d",t),s.setAttribute("stroke","rgb(235, 95, 82)"),s.setAttribute("fill","none"),s.setAttribute("stroke-linecap","cap"),s.setAttribute("stroke-width","2"),i.setAttribute("d",e),i.setAttribute("stroke","rgb(235, 95, 82)"),i.setAttribute("fill","none"),i.setAttribute("stroke-linecap","cap"),i.setAttribute("stroke-width","2"),n.appendChild(i),n.appendChild(s),n};function Z(e){return e.isFocusMode?e.nodeDataBackup:e.nodeData}const Oe=function(e,t,n){if(e){if(console.time("selectNode"),typeof e=="string")return this.selectNode(E(e));this.currentNode&&(this.currentNode.className=""),e.className="selected",this.currentNode=e,t?this.bus.fire("selectNewNode",e.nodeObj,n):this.bus.fire("selectNode",e.nodeObj,n),console.timeEnd("selectNode")}},Pe=function(){this.currentNode&&(this.currentNode.className=""),this.currentNode=null,this.bus.fire("unselectNode")},De=function(){if(!this.currentNode||this.currentNode.dataset.nodeid==="meroot")return;const e=this.currentNode.parentElement.parentElement.nextSibling;let t;const n=this.currentNode.parentElement.parentElement;if(n.className==="rhs"||n.className==="lhs"){const i=this.mindElixirBox.querySelectorAll("."+n.className),s=Array.from(i).indexOf(n);if(s+1<i.length)t=i[s+1].firstChild.firstChild;else return!1}else if(e)t=e.firstChild.firstChild;else return!1;return this.selectNode(t),!0},Ae=function(){if(!this.currentNode||this.currentNode.dataset.nodeid==="meroot")return;const e=this.currentNode.parentElement.parentElement.previousSibling;let t;const n=this.currentNode.parentElement.parentElement;if(n.className==="rhs"||n.className==="lhs"){const i=this.mindElixirBox.querySelectorAll("."+n.className),s=Array.from(i).indexOf(n);if(s-1>=0)t=i[s-1].firstChild.firstChild;else return!1}else if(e)t=e.firstChild.firstChild;else return!1;return this.selectNode(t),!0},He=function(){if(!this.currentNode)return;const e=this.currentNode.parentElement.nextSibling;if(e&&e.firstChild){const t=e.firstChild.firstChild.firstChild;this.selectNode(t)}},Re=function(){if(!this.currentNode||this.currentNode.dataset.nodeid==="meroot")return;const e=this.currentNode.parentElement.parentElement.parentElement.previousSibling;if(e){const t=e.firstChild;this.selectNode(t)}},Ie=function(){const e={nodeData:Z(this),linkData:this.linkData};return JSON.stringify(e,(t,n)=>{if(t!=="parent")return t==="from"||t==="to"?n.nodeObj.id:n})},ze=function(){const e={nodeData:Z(this),linkData:this.linkData};return JSON.parse(JSON.stringify(e,(t,n)=>{if(t!=="parent")return t==="from"||t==="to"?n.nodeObj.id:n}))},Be=function(){const e=Z(this);let t="# "+e.topic+`

`;function n(i,s){for(let o=0;o<i.length;o++)s<=6?t+="".padStart(s,"#")+" "+i[o].topic+`

`:t+="".padStart(s-7,"	")+"- "+i[o].topic+`
`,i[o].children&&n(i[o].children,s+1)}return n(e.children,2),t},je=function(){this.editable=!0},_e=function(){this.editable=!1},Ve=function(e){this.scaleVal=e,this.map.style.transform="scale("+e+")"},Ue=function(){this.container.scrollTo(1e4-this.container.offsetWidth/2,1e4-this.container.offsetHeight/2)},qe=function(e){e.nodeObj.root||(this.tempDirection===null&&(this.tempDirection=this.direction),this.isFocusMode||(this.nodeDataBackup=this.nodeData,this.isFocusMode=!0),this.nodeData=e.nodeObj,this.nodeData.root=!0,this.initRight(),this.toCenter())},Ge=function(){this.isFocusMode=!1,this.tempDirection!==null&&(delete this.nodeData.root,this.nodeData=this.nodeDataBackup,this.direction=this.tempDirection,this.tempDirection=null,this.refresh(),this.toCenter())},Fe=function(){this.direction=0,this.refresh()},Ye=function(){this.direction=1,this.refresh()},We=function(){this.direction=2,this.refresh()},Xe=function(e){this.locale=e,this.refresh()},Ke=function(e,t){const n=e.nodeObj;typeof t=="boolean"?n.expanded=t:n.expanded!==!1?n.expanded=!1:n.expanded=!0,this.layout(),this.linkDiv(),this.bus.fire("expandNode",n)},Je=function(e){e&&(this.nodeData=e.nodeData,this.linkData=e.linkData||{}),this.addParentLink(this.nodeData),this.layout(),this.linkDiv()},j=document,Ze=function(e){if(!e.style)return;const t=E(e.id,this),n={color:t.style.color&&Q(t.style.color),background:t.style.background&&Q(t.style.background),fontSize:t.style.fontSize&&t.style.fontSize+"px",fontWeight:t.style.fontWeight};t.style.color=e.style.color,t.style.background=e.style.background,t.style.fontSize=e.style.fontSize+"px",t.style.fontWeight=e.style.fontWeight||"normal",this.linkDiv(),this.bus.fire("operation",{name:"editStyle",obj:e,origin:n})},Qe=function(e,t){const n=e.tags;e.tags=t;const i=E(e.id);_(i,e),this.linkDiv(),this.bus.fire("operation",{name:"editTags",obj:e,origin:n})},et=function(e,t){const n=e.icons;e.icons=t;const i=E(e.id);_(i,e),this.linkDiv(),this.bus.fire("operation",{name:"editIcons",obj:e,origin:n})},tt=function(e,t){const n=e.hyperLink;e.hyperLink=t;const i=E(e.id);_(i,e),this.linkDiv(),this.bus.fire("operation",{name:"editHyperLink",obj:e,origin:n})},nt=function(e,t){const n=e||this.currentNode;if(!n)return;const i=n.nodeObj;if(i.root===!0){this.addChild();return}const s=t||this.generateNewObj();me(i,s),w(this.nodeData);const o=n.parentElement;console.time("insertSibling_DOM");const{grp:l,top:c}=this.createGroup(s),r=o.parentNode.parentNode;r.insertBefore(l,o.parentNode.nextSibling),r.className==="box"?(this.processPrimaryNode(l,s),this.linkDiv()):this.linkDiv(l.offsetParent),t||this.createInputDiv(c.children[0]),this.selectNode(c.children[0],!0),console.timeEnd("insertSibling_DOM"),this.bus.fire("operation",{name:"insertSibling",obj:s})},it=function(e,t){const n=e||this.currentNode;if(!n)return;const i=n.nodeObj;if(i.root===!0){this.addChild();return}const s=t||this.generateNewObj();ge(i,s),w(this.nodeData);const o=n.parentElement;console.time("insertSibling_DOM");const{grp:l,top:c}=this.createGroup(s),r=o.parentNode.parentNode;r.insertBefore(l,o.parentNode),r.className==="box"?(this.processPrimaryNode(l,s),this.linkDiv()):this.linkDiv(l.offsetParent),t||this.createInputDiv(c.children[0]),this.selectNode(c.children[0],!0),console.timeEnd("insertSibling_DOM"),this.bus.fire("operation",{name:"insertSibling",obj:s})},st=function(e,t){const n=e||this.currentNode;if(!n)return;const i=n.nodeObj;if(i.root===!0)return;const s=t||this.generateNewObj();Ne(i,s),w(this.nodeData);const o=n.parentElement.parentElement;console.time("insertParent_DOM");const{grp:l,top:c}=this.createGroup(s,!0);c.appendChild(V(!0));const r=o.parentNode;o.insertAdjacentElement("afterend",l);const g=j.createElement("children");g.appendChild(o),c.insertAdjacentElement("afterend",g),r.className==="box"?(l.className=o.className,o.className="",o.querySelector(".svg3rd").remove(),this.linkDiv()):this.linkDiv(l.offsetParent),t||this.createInputDiv(c.children[0]),this.selectNode(c.children[0],!0),console.timeEnd("insertParent_DOM"),this.bus.fire("operation",{name:"insertParent",obj:s})},le=function(e,t){if(!e)return;const n=e.nodeObj;n.expanded===!1&&(this.expandNode(e,!0),e=E(n.id));const i=t||this.generateNewObj();n.children?n.children.push(i):n.children=[i],w(this.nodeData);const s=e.parentElement,{grp:o,top:l}=this.createGroup(i);if(s.tagName==="T"){if(s.children[1])s.nextSibling.appendChild(o);else{const c=j.createElement("children");c.appendChild(o),s.appendChild(V(!0)),s.insertAdjacentElement("afterend",c)}this.linkDiv(o.offsetParent)}else s.tagName==="ROOT"&&(this.processPrimaryNode(o,i),s.nextSibling.appendChild(o),this.linkDiv());return{newTop:l,newNodeObj:i}},ot=function(e,t){console.time("addChild");const n=e||this.currentNode;if(!n)return;const{newTop:i,newNodeObj:s}=le.call(this,n,t);this.bus.fire("operation",{name:"addChild",obj:s}),console.timeEnd("addChild"),t||this.createInputDiv(i.children[0]),this.selectNode(i.children[0],!0)},lt=function(e,t){console.time("copyNode");const n=JSON.parse(JSON.stringify(e.nodeObj,(s,o)=>{if(s!=="parent")return o}));se(n);const{newNodeObj:i}=le.call(this,t,n);console.timeEnd("copyNode"),this.bus.fire("operation",{name:"copyNode",obj:i})},rt=function(e){const t=e||this.currentNode;if(!t)return;const n=t.parentNode.parentNode,i=t.nodeObj;fe(i),n.parentNode.insertBefore(n,n.previousSibling),this.linkDiv(),this.bus.fire("operation",{name:"moveUpNode",obj:i})},ct=function(e){const t=e||this.currentNode;if(!t)return;const n=t.parentNode.parentNode,i=t.nodeObj;pe(i),n.nextSibling?n.insertAdjacentElement("afterend",n.nextSibling):n.parentNode.prepend(n),this.linkDiv(),this.bus.fire("operation",{name:"moveDownNode",obj:i})},at=function(e){const t=e||this.currentNode;if(!t)return;const n=t.nodeObj;if(n.root===!0)throw new Error("Can not remove root node");const i=n.parent.children.findIndex(r=>r===n),s=n.parent.children[i+1],o=s&&s.id,l=Y(n),c=t.parentNode;if(c.tagName!=="ROOT"){if(l===0){const r=c.parentNode.parentNode.previousSibling;r.tagName!=="ROOT"&&r.children[1].remove(),this.selectParent()}else this.selectPrevSibling()||this.selectNextSibling();for(const r in this.linkData){const g=this.linkData[r];(g.from===c.firstChild||g.to===c.firstChild)&&this.removeLink(this.mindElixirBox.querySelector(`[data-linkid=${this.linkData[r].id}]`))}c.parentNode.remove(),this.linkDiv(),this.bus.fire("operation",{name:"removeNode",obj:n,originSiblingId:o,originParentId:n.parent.id})}},dt=function(e,t){const n=e.nodeObj,i=t.nodeObj,s=n.parent.id;if(i.expanded===!1&&(this.expandNode(t,!0),e=E(n.id),t=E(i.id)),!ue(n,i)){console.warn("Invalid move");return}console.time("moveNode"),be(n,i),w(this.nodeData);const o=e.parentElement,l=o.parentNode.parentNode,c=t.parentElement;if(l.className==="box"?o.parentNode.lastChild.remove():o.parentNode.className==="box"&&(o.style.cssText=""),c.tagName==="T")if(l.className==="box"&&(o.parentNode.className=""),c.children[1])c.nextSibling.appendChild(o.parentNode);else{const r=j.createElement("children");r.appendChild(o.parentNode),c.appendChild(V(!0)),c.parentElement.insertBefore(r,c.nextSibling)}else c.tagName==="ROOT"&&(this.processPrimaryNode(o.parentNode,n),c.nextSibling.appendChild(o.parentNode));this.linkDiv(),this.bus.fire("operation",{name:"moveNode",obj:{fromObj:n,toObj:i,originParentId:s}}),console.timeEnd("moveNode")},ht=function(e,t){const n=e.nodeObj,i=t.nodeObj,s=n.parent.id;ve(n,i),w(this.nodeData);const l=e.parentElement.parentNode,c=t.parentElement,r=c.parentNode;c.parentNode.parentNode.insertBefore(l,r),r.className&&(l.className=r.className),this.linkDiv(),this.bus.fire("operation",{name:"moveNodeBefore",obj:{fromObj:n,toObj:i,originParentId:s}})},ut=function(e,t){const n=e.nodeObj,i=t.nodeObj,s=n.parent.id;ye(n,i),w(this.nodeData);const l=e.parentElement.parentNode,c=t.parentElement,r=c.parentNode;c.parentNode.parentNode.insertBefore(l,r.nextSibling),r.className&&(l.className=r.className),this.linkDiv(),this.bus.fire("operation",{name:"moveNodeAfter",obj:{fromObj:n,toObj:i,originParentId:s}})},ft=function(e){const t=e||this.currentNode;t&&this.createInputDiv(t)},pt=function(e,t){e.childNodes[0].textContent=t,e.nodeObj.topic=t,this.linkDiv()};function mt(e,t){if(this.direction===0)e.className="lhs";else if(this.direction===1)e.className="rhs";else if(this.direction===2){const n=j.querySelectorAll(".lhs").length,i=j.querySelectorAll(".rhs").length;n<=i?(e.className="lhs",t.direction=0):(e.className="rhs",t.direction=1)}}const gt=function(e,t,n,i){const s=this.map.getBoundingClientRect();if(!e||!t)return;const o=e.getBoundingClientRect(),l=t.getBoundingClientRect(),c=(o.x+o.width/2-s.x)/this.scaleVal,r=(o.y+o.height/2-s.y)/this.scaleVal,g=(l.x+l.width/2-s.x)/this.scaleVal,m=(l.y+l.height/2-s.y)/this.scaleVal;let v,a,N,p;n?(v=c+i.delta1.x,a=r+i.delta1.y,N=g+i.delta2.x,p=m+i.delta2.y):(r+m)/2-r<=o.height/2?(v=(o.x+o.width-s.x)/this.scaleVal+100,a=r,N=(l.x+l.width-s.x)/this.scaleVal+100,p=m):(v=(c+g)/2,a=(r+m)/2,N=(c+g)/2,p=(r+m)/2);const y={cx:c,cy:r,w:o.width,h:o.height},b={cx:g,cy:m,w:l.width,h:l.height},h=W(y,v,a),f=h.x,d=h.y,u=X(b,N,p),x=u.x,C=u.y,U=oe(N,p,x,C),A=Me(`M ${f} ${d} C ${v} ${a} ${N} ${p} ${x} ${C}`,`M ${U.x1} ${U.y1} L ${x} ${C} L ${U.x2} ${U.y2}`);let T;n?(T={id:i.id,label:"",from:e,to:t,delta1:{x:v-c,y:a-r},delta2:{x:N-g,y:p-m}},this.linkData[i.id]=T,A.linkObj=T,A.dataset.linkid=i.id):(T={id:F(),label:"",from:e,to:t,delta1:{x:v-c,y:a-r},delta2:{x:N-g,y:p-m}},this.linkData[T.id]=T,A.linkObj=T,A.dataset.linkid=T.id,this.currentLink=A),this.linkSvgGroup.appendChild(A),n||this.showLinkController(v,a,N,p,T,y,b)},Nt=function(e){let t;if(e?t=e:t=this.currentLink,!t)return;console.log(t),this.hideLinkController();const n=t.linkObj.id;console.log(n),delete this.linkData[n],t.remove(),t=null},bt=function(e){this.currentLink=e;const t=e.linkObj,n=t.from,i=t.to,s=this.map.getBoundingClientRect(),o=n.getBoundingClientRect(),l=i.getBoundingClientRect(),c=(o.x+o.width/2-s.x)/this.scaleVal,r=(o.y+o.height/2-s.y)/this.scaleVal,g=(l.x+l.width/2-s.x)/this.scaleVal,m=(l.y+l.height/2-s.y)/this.scaleVal,v={cx:c,cy:r,w:o.width,h:o.height},a={cx:g,cy:m,w:l.width,h:l.height},N=c+t.delta1.x,p=r+t.delta1.y,y=g+t.delta2.x,b=m+t.delta2.y;this.showLinkController(N,p,y,b,t,v,a)},vt=function(){this.linkController.style.display="none",this.P2.style.display="none",this.P3.style.display="none"},yt=function(e,t,n,i,s,o,l){this.linkController.style.display="initial",this.P2.style.display="initial",this.P3.style.display="initial";const c=W(o,e,t);let r=c.x,g=c.y;const m=X(l,n,i);let v=m.x,a=m.y;this.P2.style.cssText=`top:${t}px;left:${e}px;`,this.P3.style.cssText=`top:${i}px;left:${n}px;`,this.line1.setAttribute("x1",r),this.line1.setAttribute("y1",g),this.line1.setAttribute("x2",e),this.line1.setAttribute("y2",t),this.line2.setAttribute("x1",n),this.line2.setAttribute("y1",i),this.line2.setAttribute("x2",v),this.line2.setAttribute("y2",a),this.helper1&&(this.helper1.destory(this.map),this.helper2.destory(this.map)),this.helper1=new B(this.P2),this.helper2=new B(this.P3),this.helper1.init(this.map,(N,p)=>{e=e-N/this.scaleVal,t=t-p/this.scaleVal;const y=W(o,e,t);r=y.x,g=y.y,this.P2.style.top=t+"px",this.P2.style.left=e+"px",this.currentLink.children[0].setAttribute("d",`M ${r} ${g} C ${e} ${t} ${n} ${i} ${v} ${a}`),this.line1.setAttribute("x1",r),this.line1.setAttribute("y1",g),this.line1.setAttribute("x2",e),this.line1.setAttribute("y2",t),s.delta1.x=e-o.cx,s.delta1.y=t-o.cy}),this.helper2.init(this.map,(N,p)=>{n=n-N/this.scaleVal,i=i-p/this.scaleVal;const y=X(l,n,i);v=y.x,a=y.y;const b=oe(n,i,v,a);this.P3.style.top=i+"px",this.P3.style.left=n+"px",this.currentLink.children[0].setAttribute("d",`M ${r} ${g} C ${e} ${t} ${n} ${i} ${v} ${a}`),this.currentLink.children[1].setAttribute("d",`M ${b.x1} ${b.y1} L ${v} ${a} L ${b.x2} ${b.y2}`),this.line2.setAttribute("x1",n),this.line2.setAttribute("y1",i),this.line2.setAttribute("x2",v),this.line2.setAttribute("y2",a),s.delta2.x=n-l.cx,s.delta2.y=i-l.cy})};function xt(e){var t=this.primaryNodeHorizontalGap||65,n=this.primaryNodeVerticalGap||25;console.time("linkDiv");const i=this.root;i.style.cssText=`top:${1e4-i.offsetHeight/2}px;left:${1e4-i.offsetWidth/2}px;`;const s=this.box.children;this.svg2nd.innerHTML="";let o=0,l,c=0,r=0,g=0,m=0,v=0,a;if(this.direction===2){let b=0,h=0,f=0,d=0;for(let u=0;u<s.length;u++){const x=s[u];x.className==="lhs"?(m+=x.offsetHeight+n,f+=x.offsetHeight,b+=1):(v+=x.offsetHeight+n,d+=x.offsetHeight,h+=1)}m>v?(a=1e4-Math.max(m)/2,l="r",c=(m-d)/(h-1)):(a=1e4-Math.max(v)/2,l="l",c=(v-f)/(b-1))}else{for(let b=0;b<s.length;b++){const h=s[b];o+=h.offsetHeight+n}a=1e4-o/2}let N="";const p=1e4-i.offsetWidth/2-t,y=1e4+i.offsetWidth/2+t;for(let b=0;b<s.length;b++){let h,f;const d=s[b],u=d.offsetHeight;if(d.className==="lhs"){d.style.top=a+r+"px",d.style.left=p-d.offsetWidth+"px",h=p-15,f=a+r+u/2;let C=1e4;this.primaryLinkStyle===2?(this.direction===2&&(C=1e4-i.offsetWidth/6),f<1e4?N+=`M ${C} 10000 V ${f+20} C ${C} ${f} ${C} ${f} ${C-20} ${f} H ${h}`:N+=`M ${C} 10000 V ${f-20} C ${C} ${f} ${C} ${f} ${C-20} ${f} H ${h}`):N+=`M 10000 10000 C 10000 10000 ${1e4+2*t*.03} ${f} ${h} ${f}`,l==="l"?r+=u+c:r+=u+n}else{d.style.top=a+g+"px",d.style.left=y+"px",h=y+15,f=a+g+u/2;let C=1e4;this.primaryLinkStyle===2?(this.direction===2&&(C=1e4+i.offsetWidth/6),f<1e4?N+=`M ${C} 10000 V ${f+20} C ${C} ${f} ${C} ${f} ${C+20} ${f} H ${h}`:N+=`M ${C} 10000 V ${f-20} C ${C} ${f} ${C} ${f} ${C+20} ${f} H ${h}`):N+=`M 10000 10000 C 10000 10000 ${1e4+2*t*.03} ${f} ${h} ${f}`,l==="r"?g+=u+c:g+=u+n}const x=d.children[0].children[1];x&&(x.style.top=(x.parentNode.offsetHeight-x.offsetHeight)/2+"px",d.className==="lhs"?x.style.left="-10px":x.style.left=x.parentNode.offsetWidth-10+"px")}this.svg2nd.appendChild(Te(N));for(let b=0;b<s.length;b++){const h=s[b];if(!(e&&e!==s[b])&&h.childElementCount){const f=q("svg3rd");h.lastChild.tagName==="svg"&&h.lastChild.remove(),h.appendChild(f);const d=h.children[0],u=h.children[1].children;S="",re(u,d,!0),f.appendChild(Se(S))}}this.linkSvgGroup.innerHTML="";for(const b in this.linkData){const h=this.linkData[b];typeof h.from=="string"?this.createLink(E(h.from),E(h.to),!0,h):this.createLink(E(h.from.nodeObj.id),E(h.to.nodeObj.id),!0,h)}console.timeEnd("linkDiv")}let S="";function re(e,t,n){const i=t.offsetTop,s=t.offsetLeft,o=t.offsetWidth,l=t.offsetHeight;for(let c=0;c<e.length;c++){const r=e[c],g=r.children[0],m=g.offsetTop,v=g.offsetHeight;let a;n?a=i+l/2:a=i+l;const N=m+v;let p,y,b;const h=r.offsetParent.className;h==="lhs"?(p=s+15,b=s,y=s-g.offsetWidth+15,m+v<i+l/2+50&&m+v>i+l/2-50?S+=`M ${p} ${a} H ${b} V ${N} H ${y}`:m+v>=i+l/2?S+=`M ${p} ${a} H ${b} V ${N-8} A 8 8 0 0 1 ${b-8} ${N} H ${y}`:S+=`M ${p} ${a} H ${b} V ${N+8} A 8 8 0 0 0 ${b-8} ${N} H ${y}`):h==="rhs"&&(p=s+o-15,b=s+o,y=s+o+g.offsetWidth-15,m+v<i+l/2+50&&m+v>i+l/2-50?S+=`M ${p} ${a} H ${b} V ${N} H ${y}`:m+v>=i+l/2?S+=`M ${p} ${a} H ${b} V ${N-8} A 8 8 0 0 0 ${b+8} ${N} H ${y}`:S+=`M ${p} ${a} H ${b} V ${N+8} A 8 8 0 0 1 ${b+8} ${N} H ${y}`);const f=g.children[1];if(f){if(f.style.top=(g.offsetHeight-f.offsetHeight)/2+"px",h==="lhs"?f.style.left="-10px":h==="rhs"&&(f.style.left=g.offsetWidth-10+"px"),!f.expanded)continue}else continue;const d=r.children[1].children;d.length>0&&re(d,g)}}function Ct(e){e.map.addEventListener("click",t=>{t.target.nodeName==="EPD"?e.expandNode(t.target.previousSibling):t.target.parentElement.nodeName==="T"||t.target.parentElement.nodeName==="ROOT"?e.selectNode(t.target,!1,t):t.target.nodeName==="path"?t.target.parentElement.nodeName==="g"&&e.selectLink(t.target.parentElement):t.target.className==="circle"||(e.unselectNode(),e.hideLinkController&&e.hideLinkController())}),e.map.addEventListener("dblclick",t=>{t.preventDefault(),e.editable&&(t.target.parentElement.nodeName==="T"||t.target.parentElement.nodeName==="ROOT")&&e.beginEdit(t.target)}),e.map.addEventListener("mousemove",t=>{t.target.contentEditable!=="true"&&I.onMove(t,e.container)}),e.map.addEventListener("mousedown",t=>{t.target.contentEditable!=="true"&&(I.afterMoving=!1,I.mousedown=!0)}),e.map.addEventListener("mouseleave",t=>{I.clear()}),e.map.addEventListener("mouseup",t=>{I.clear()})}const te={addChild:"插入子节点",addParent:"插入父节点",addSibling:"插入同级节点",removeNode:"删除节点",focus:"专注",cancelFocus:"取消专注",moveUp:"上移",moveDown:"下移",link:"连接",clickTips:"请点击目标节点",font:"文字",background:"背景",tag:"标签",icon:"图标",tagsSeparate:"多个标签半角逗号分隔",iconsSeparate:"多个图标半角逗号分隔",url:"URL"},k={cn:te,zh_CN:te,zh_TW:{addChild:"插入子節點",addParent:"插入父節點",addSibling:"插入同級節點",removeNode:"刪除節點",focus:"專注",cancelFocus:"取消專注",moveUp:"上移",moveDown:"下移",link:"連接",clickTips:"請點擊目標節點",font:"文字",background:"背景",tag:"標簽",icon:"圖標",tagsSeparate:"多個標簽半角逗號分隔",iconsSeparate:"多個圖標半角逗號分隔",url:"URL"},en:{addChild:"Add child",addParent:"Add parent",addSibling:"Add sibling",removeNode:"Remove node",focus:"Focus Mode",cancelFocus:"Cancel Focus Mode",moveUp:"Move up",moveDown:"Move down",link:"Link",clickTips:"Please click the target node",font:"Font",background:"Background",tag:"Tag",icon:"Icon",tagsSeparate:"Separate tags by comma",iconsSeparate:"Separate icons by comma",url:"URL"},ja:{addChild:"子ノードを追加する",addParent:"親ノードを追加します",addSibling:"兄弟ノードを追加する",removeNode:"ノードを削除",focus:"集中",cancelFocus:"集中解除",moveUp:"上へ移動",moveDown:"下へ移動",link:"コネクト",clickTips:"ターゲットノードをクリックしてください",font:"フォント",background:"バックグラウンド",tag:"タグ",icon:"アイコン",tagsSeparate:"複数タグはカンマ区切り",iconsSeparate:"複数アイコンはカンマ区切り",url:"URL"},pt:{addChild:"Adicionar item filho",addParent:"Adicionar item pai",addSibling:"Adicionar item irmao",removeNode:"Remover item",focus:"Modo Foco",cancelFocus:"Cancelar Modo Foco",moveUp:"Mover para cima",moveDown:"Mover para baixo",link:"Link",clickTips:"Favor clicar no item alvo",font:"Fonte",background:"Cor de fundo",tag:"Tag",icon:"Icone",tagsSeparate:"Separe tags por virgula",iconsSeparate:"Separe icones por virgula",url:"URL"}};function kt(e,t){const n=h=>{const f=document.createElement("div");return f.innerText=h,f.style.cssText="position:absolute;bottom:20px;left:50%;transform:translateX(-50%);",f},i=(h,f,d)=>{const u=document.createElement("li");return u.id=h,u.innerHTML=`<span>${G(f)}</span><span>${G(d)}</span>`,u},s=k[e.locale]?e.locale:"en",o=i("cm-add_child",k[s].addChild,"tab"),l=i("cm-add_parent",k[s].addParent,""),c=i("cm-add_sibling",k[s].addSibling,"enter"),r=i("cm-remove_child",k[s].removeNode,"delete"),g=i("cm-fucus",k[s].focus,""),m=i("cm-unfucus",k[s].cancelFocus,""),v=i("cm-up",k[s].moveUp,"PgUp"),a=i("cm-down",k[s].moveDown,"Pgdn"),N=i("cm-down",k[s].link,""),p=document.createElement("ul");if(p.className="menu-list",p.appendChild(o),p.appendChild(l),p.appendChild(c),p.appendChild(r),(!t||t.focus)&&(p.appendChild(g),p.appendChild(m)),p.appendChild(v),p.appendChild(a),(!t||t.link)&&p.appendChild(N),t&&t.extend)for(let h=0;h<t.extend.length;h++){const f=t.extend[h],d=i(f.name,f.name,f.key||"");p.appendChild(d),d.onclick=u=>{f.onclick(u)}}const y=document.createElement("cmenu");y.appendChild(p),y.hidden=!0,e.container.append(y);let b=!0;e.container.oncontextmenu=function(h){if(h.preventDefault(),!e.editable)return;const f=h.target;if(f.tagName==="TPC"){f.parentElement.tagName==="ROOT"?b=!0:b=!1,b?(g.className="disabled",v.className="disabled",a.className="disabled",c.className="disabled",r.className="disabled"):(g.className="",v.className="",a.className="",c.className="",r.className=""),e.selectNode(f),y.hidden=!1;const d=p.offsetHeight,u=p.offsetWidth;d+h.clientY>window.innerHeight?(p.style.top="",p.style.bottom="0px"):(p.style.bottom="",p.style.top=h.clientY+15+"px"),u+h.clientX>window.innerWidth?(p.style.left="",p.style.right="0px"):(p.style.right="",p.style.left=h.clientX+10+"px")}},y.onclick=h=>{h.target===y&&(y.hidden=!0)},o.onclick=h=>{e.addChild(),y.hidden=!0},l.onclick=h=>{e.insertParent(),y.hidden=!0},c.onclick=h=>{b||(e.insertSibling(),y.hidden=!0)},r.onclick=h=>{b||(e.removeNode(),y.hidden=!0)},g.onclick=h=>{b||(e.focusNode(e.currentNode),y.hidden=!0)},m.onclick=h=>{e.cancelFocus(),y.hidden=!0},v.onclick=h=>{b||(e.moveUpNode(),y.hidden=!0)},a.onclick=h=>{b||(e.moveDownNode(),y.hidden=!0)},N.onclick=h=>{y.hidden=!0;const f=e.currentNode,d=n(k[s].clickTips);e.container.appendChild(d),e.map.addEventListener("click",u=>{u.preventDefault(),d.remove(),u.target.parentElement.nodeName==="T"||u.target.parentElement.nodeName==="ROOT"?e.createLink(f,e.currentNode):console.log("link cancel")},{once:!0})}}const O=(e,t)=>{const n=document.createElement("span");return n.id=e,n.innerHTML=`<svg class="icon" aria-hidden="true">
    <use xlink:href="#icon-${t}"></use>
  </svg>`,n};function Et(e){const t=document.createElement("toolbar"),n=O("fullscreen","full"),i=O("toCenter","living"),s=O("zoomout","move"),o=O("zoomin","add"),l=document.createElement("span");return l.innerText="100%",t.appendChild(n),t.appendChild(i),t.appendChild(s),t.appendChild(o),t.className="rb",n.onclick=()=>{e.container.requestFullscreen()},i.onclick=()=>{e.toCenter()},s.onclick=()=>{e.scaleVal<.6||e.scale(e.scaleVal-=.2)},o.onclick=()=>{e.scaleVal>1.6||e.scale(e.scaleVal+=.2)},t}function Lt(e){const t=document.createElement("toolbar"),n=O("tbltl","left"),i=O("tbltr","right"),s=O("tblts","side");return t.appendChild(n),t.appendChild(i),t.appendChild(s),t.className="lt",n.onclick=()=>{e.initLeft()},i.onclick=()=>{e.initRight()},s.onclick=()=>{e.initSide()},t}function $t(e){e.container.append(Et(e)),e.container.append(Lt(e))}const z=(e,t)=>{const n=document.createElement("div");return n.id=e,n.innerHTML=t,n},wt=["#2c3e50","#34495e","#7f8c8d","#94a5a6","#bdc3c7","#ecf0f1","#8e44ad","#9b59b6","#2980b9","#3298db","#c0392c","#e74c3c","#d35400","#f39c11","#f1c40e","#17a085","#27ae61","#2ecc71"];function Tt(e){function t(d,u){var x=e.container.querySelectorAll(d);[].forEach.call(x,function(C){C.classList.remove(u)})}const n=k[e.locale]?e.locale:"en",i=z("nm-style",`
  <div class="nm-fontsize-container">
    ${["15","24","32"].map(d=>`<div class="size"  data-size="${d}">
    <svg class="icon" style="width: ${d}px;height: ${d}px" aria-hidden="true">
      <use xlink:href="#icon-a"></use>
    </svg></div>`).join("")}<div class="bold"><svg class="icon" aria-hidden="true">
<use xlink:href="#icon-B"></use>
</svg></div>
  </div>
  <div class="nm-fontcolor-container">
    ${wt.map(d=>`<div class="split6"><div class="palette" data-color="${d}" style="background-color: ${d};"></div></div>`).join("")}
  </div>
  <div class="bof">
  <span class="font">${k[n].font}</span>
  <span class="background">${k[n].background}</span>
  </div>`),s=z("nm-tag",`${k[n].tag}<input class="nm-tag" tabindex="-1" placeholder="${k[n].tagsSeparate}" />`),o=z("nm-icon",`${k[n].icon}<input class="nm-icon" tabindex="-1" placeholder="${k[n].iconsSeparate}" />`),l=z("nm-url",`${k[n].url}<input class="nm-url" tabindex="-1" />`),c=z("nm-memo",`${k[n].memo||"Memo"}<textarea class="nm-memo" rows="5" tabindex="-1" />`),r=document.createElement("nmenu");r.innerHTML=`
  <div class="button-container"><svg class="icon" aria-hidden="true">
  <use xlink:href="#icon-close"></use>
  </svg></div>
  `,r.appendChild(i),r.appendChild(s),r.appendChild(o),r.appendChild(l),r.appendChild(c),r.hidden=!0,e.container.append(r);const g=r.querySelectorAll(".size"),m=r.querySelector(".bold"),v=r.querySelector(".button-container"),a=r.querySelector(".font"),N=e.container.querySelector(".nm-tag"),p=e.container.querySelector(".nm-icon"),y=e.container.querySelector(".nm-url"),b=e.container.querySelector(".nm-memo");let h;r.onclick=d=>{if(!e.currentNode)return;const u=e.currentNode.nodeObj,x=d.target;x.className==="palette"?(u.style||(u.style={}),t(".palette","nmenu-selected"),x.className="palette nmenu-selected",h==="font"?u.style.color=x.dataset.color:h==="background"&&(u.style.background=x.dataset.color),e.updateNodeStyle(u)):x.className==="background"?(t(".palette","nmenu-selected"),h="background",x.className="background selected",x.previousElementSibling.className="font",u.style&&u.style.background&&(r.querySelector('.palette[data-color="'+u.style.background+'"]').className="palette nmenu-selected")):x.className==="font"&&(t(".palette","nmenu-selected"),h="font",x.className="font selected",x.nextElementSibling.className="background",u.style&&u.style.color&&(r.querySelector('.palette[data-color="'+u.style.color+'"]').className="palette nmenu-selected"))},Array.from(g).map(d=>{d.onclick=u=>{e.currentNode.nodeObj.style||(e.currentNode.nodeObj.style={}),t(".size","size-selected");const x=u.currentTarget;e.currentNode.nodeObj.style.fontSize=x.dataset.size,x.className="size size-selected",e.updateNodeStyle(e.currentNode.nodeObj)}}),m.onclick=d=>{e.currentNode.nodeObj.style||(e.currentNode.nodeObj.style={}),e.currentNode.nodeObj.style.fontWeight==="bold"?(delete e.currentNode.nodeObj.style.fontWeight,d.currentTarget.className="bold",e.updateNodeStyle(e.currentNode.nodeObj)):(e.currentNode.nodeObj.style.fontWeight="bold",d.currentTarget.className="bold size-selected",e.updateNodeStyle(e.currentNode.nodeObj))},N.onchange=d=>{if(e.currentNode&&typeof d.target.value=="string"){const u=d.target.value.split(",");e.updateNodeTags(e.currentNode.nodeObj,u.filter(x=>x))}},p.onchange=d=>{if(e.currentNode&&typeof d.target.value=="string"){const u=d.target.value.split(",");e.updateNodeIcons(e.currentNode.nodeObj,u.filter(x=>x))}},y.onchange=d=>{e.currentNode&&e.updateNodeHyperLink(e.currentNode.nodeObj,d.target.value)},b.onchange=d=>{e.currentNode&&(e.currentNode.nodeObj.memo=d.target.value)};let f="open";v.onclick=d=>{f==="open"?(f="close",r.className="close",v.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"></use></svg>'):(f="open",r.className="",v.innerHTML='<svg class="icon" aria-hidden="true"><use xlink:href="#icon-close"></use></svg>')},e.bus.addListener("unselectNode",function(){r.hidden=!0}),e.bus.addListener("selectNode",function(d,u){u&&(r.hidden=!1,t(".palette","nmenu-selected"),t(".size","size-selected"),t(".bold","size-selected"),h="font",a.className="font selected",a.nextElementSibling.className="background",d.style&&(d.style.fontSize&&(r.querySelector('.size[data-size="'+d.style.fontSize+'"]').className="size size-selected"),d.style.fontWeight&&(r.querySelector(".bold").className="bold size-selected"),d.style.color&&(r.querySelector('.palette[data-color="'+d.style.color+'"]').className="palette nmenu-selected")),d.tags?N.value=d.tags.join(","):N.value="",d.icons?p.value=d.icons.join(","):p.value="",y.value=d.hyperLink||"",b.value=d.memo||"")})}const K=document,St=function(e,t){if(!t)return J(e),e;const n=e.getElementsByClassName("insert-preview"),i=`insert-preview ${t} show`;if(n.length>0)n[0].className=i;else{const s=K.createElement("div");s.className=i,e.appendChild(s)}return e},J=function(e){if(!e)return;const t=e.getElementsByClassName("insert-preview");for(const n of t||[])n.remove()},ne=function(e,t){const n=t.parentNode.parentNode.contains(e);return e&&e.tagName==="TPC"&&e!==t&&!n&&e.nodeObj.root!==!0};function Mt(e){let t,n,i;e.map.addEventListener("dragstart",function(o){t=o.target,t.parentNode.parentNode.style.opacity="0.5",I.clear()}),e.map.addEventListener("dragend",async function(o){o.target.style.opacity="",J(i);const l=t.nodeObj;switch(n){case"before":e.moveNodeBefore(t,i),e.selectNode(E(l.id));break;case"after":e.moveNodeAfter(t,i),e.selectNode(E(l.id));break;case"in":e.moveNode(t,i);break}t.parentNode.parentNode.style.opacity="1",t=null}),e.map.addEventListener("dragover",de(function(o){J(i);const l=K.elementFromPoint(o.clientX,o.clientY-12);if(ne(l,t)){i=l;const c=l.getBoundingClientRect().y;o.clientY>c+l.clientHeight?n="after":o.clientY>c+l.clientHeight/2&&(n="in")}else{const c=K.elementFromPoint(o.clientX,o.clientY+12);if(ne(c,t)){i=c;const r=c.getBoundingClientRect().y;o.clientY<r?n="before":o.clientY<r+c.clientHeight/2&&(n="in")}else n=i=null}i&&St(i,n)},200))}function Ot(e){const t={13:()=>{e.insertSibling()},9:()=>{e.addChild()},113:()=>{e.beginEdit()},38:()=>{e.selectPrevSibling()},40:()=>{e.selectNextSibling()},37:()=>{e.currentNode&&(e.currentNode.offsetParent.offsetParent.className==="rhs"?e.selectParent():(e.currentNode.offsetParent.offsetParent.className==="lhs"||e.currentNode.nodeObj.root)&&e.selectFirstChild())},39:()=>{e.currentNode&&(e.currentNode.offsetParent.offsetParent.className==="rhs"||e.currentNode.nodeObj.root?e.selectFirstChild():e.currentNode.offsetParent.offsetParent.className==="lhs"&&e.selectParent())},33(){e.moveUpNode()},34(){e.moveDownNode()},67(n){(n.metaKey||n.ctrlKey)&&(e.waitCopy=e.currentNode)},86(n){e.waitCopy&&(n.metaKey||n.ctrlKey)&&(e.copyNode(e.waitCopy,e.currentNode),e.waitCopy=null)},90:n=>{e.allowUndo&&(n.metaKey||n.ctrlKey)&&e.undo()},187:n=>{if(n.metaKey||n.ctrlKey){if(e.scaleVal>1.6)return;e.scale(e.scaleVal+=.2)}},189:n=>{if(n.metaKey||n.ctrlKey){if(e.scaleVal<.6)return;e.scale(e.scaleVal-=.2)}}};e.map.onkeydown=n=>{n.preventDefault(),e.editable&&n.target===n.currentTarget&&(n.keyCode===8||n.keyCode===46?e.currentLink?e.removeLink():e.removeNode():t[n.keyCode]&&t[n.keyCode](n))}}function Pt(e,t){const n=(a,N)=>{const p=document.createElement("div");return p.id=a,p.innerHTML=`<svg class="icon" aria-hidden="true">
    <use xlink:href="#icon-${N}"></use>
  </svg>`,p},i=n("cm-add_child","zijiedian"),s=n("cm-add_sibling","tongjijiedian-"),o=n("cm-remove_child","shanchu2"),l=n("cm-up","rising"),c=n("cm-down","falling"),r=n("cm-edit","edit"),g=document.createElement("ul");if(g.className="menu-list",t&&t.extend)for(let a=0;a<t.extend.length;a++){const N=t.extend[a],p=n(N.name,N.name);g.appendChild(p),p.onclick=y=>{N.onclick(y)}}const m=document.createElement("mmenu");m.appendChild(i),m.appendChild(s),m.appendChild(o),m.appendChild(l),m.appendChild(c),m.appendChild(r),m.hidden=!0,e.container.append(m);let v=!0;e.bus.addListener("unselectNode",function(){m.hidden=!0}),e.bus.addListener("selectNode",function(a){m.hidden=!1,a.root?v=!0:v=!1}),m.onclick=a=>{a.target===m&&(m.hidden=!0)},i.onclick=a=>{e.addChild()},s.onclick=a=>{v||e.insertSibling()},o.onclick=a=>{v||e.removeNode()},l.onclick=a=>{v||e.moveUpNode()},c.onclick=a=>{v||e.moveDownNode()},r.onclick=a=>{e.beginEdit()}}function ce(){this.handlers={}}ce.prototype={showHandler:function(){console.log(this.handlers)},addListener:function(e,t){this.handlers[e]===void 0&&(this.handlers[e]=[]),this.handlers[e].push(t)},fire:function(e,...t){if(this.handlers[e]instanceof Array)for(var n=this.handlers[e],i=0;i<n.length;i++)n[i](...t)},removeListener:function(e,t){if(this.handlers[e]){var n=this.handlers[e];if(!t)n.length=0;else if(n.length)for(var i=0;i<n.length;i++)n[i]===t&&this.handlers[e].splice(i,1)}}};(function(e){var t,n,i,s,o,l,c='<svg><symbol id="icon-edit" viewBox="0 0 1024 1024"><path d="M423.765333 128a42.666667 42.666667 0 0 1 3.2 85.205333L423.765333 213.333333H234.666667a64 64 0 0 0-63.872 60.245334L170.666667 277.333333v512a64 64 0 0 0 60.245333 63.872L234.666667 853.333333h512a64 64 0 0 0 63.872-60.245333L810.666667 789.333333v-189.098666a42.666667 42.666667 0 0 1 85.205333-3.2l0.128 3.2V789.333333a149.333333 149.333333 0 0 1-144.213333 149.248L746.666667 938.666667h-512a149.333333 149.333333 0 0 1-149.248-144.213334L85.333333 789.333333v-512a149.333333 149.333333 0 0 1 144.213334-149.248L234.666667 128h189.098666z m324.949334-53.248a42.666667 42.666667 0 0 1 60.330666 0l150.869334 150.869333a42.666667 42.666667 0 0 1 0 60.330667l-329.386667 329.386667a42.666667 42.666667 0 0 1-29.44 12.458666l-153.386667 2.517334a42.666667 42.666667 0 0 1-43.349333-43.349334l2.56-153.386666a42.666667 42.666667 0 0 1 12.458667-29.44z m30.165333 90.496L491.946667 452.266667l-1.493334 91.989333 92.032-1.493333 286.976-286.976-90.538666-90.538667z"  ></path></symbol><symbol id="icon-rising" viewBox="0 0 1024 1024"><path d="M553.173333 803.84h-64l0.021334-474.581333-224.021334 224-45.269333-45.226667L521.6 206.293333l301.717333 301.696-45.269333 45.269334-224.853333-224.896v475.477333z"  ></path></symbol><symbol id="icon-falling" viewBox="0 0 1024 1024"><path d="M553.173333 238.314667h-64l0.021334 474.602666-224.021334-224-45.269333 45.226667L521.6 835.861333l301.717333-301.717333-45.269333-45.226667-224.853333 224.853334V238.336z"  ></path></symbol><symbol id="icon-shanchu2" viewBox="0 0 1024 1024"><path d="M516.60601807 107.93026734c-82.64382935 0-149.71865844 65.51751709-152.5729065 147.77160644H171.37136841c-21.40603638 0-38.92044068 17.38504028-38.92044068 38.92126465 0 21.40686036 17.38504028 38.92208862 38.92126466 38.92208862h42.94308471v435.40136719c0 81.73498536 55.39828492 148.55026245 123.90106201 148.55026245h348.99444581c68.37341309 0 123.90106201-66.42553711 123.901062-148.55026245V333.80477906h38.92126465c21.40686036 0 38.92126464-17.38586426 38.92126465-38.92208863 0-21.40686036-17.38504028-38.92126464-38.92126465-38.92126465H668.91854859C666.45321656 173.44860839 599.24902344 107.93109131 516.60601807 107.93109131z m-79.65939331 147.77160644c2.85424805-42.16442872 37.2354126-74.85809326 79.78875732-74.85809326s76.93450927 32.82302857 79.39984131 74.85809326H436.94662476z m-98.86047364 589.01165771c-24.2611084 0-50.98754883-31.13717651-50.98754883-75.76693725V333.80477906h450.97036744V769.33551026c0 44.50039673-26.72644043 75.76776123-50.98754884 75.76776122H338.08615112v-0.38973999z m0 0"  ></path><path d="M390.37063599 751.17263794c17.77313232 0 32.43411255-17.7739563 32.43411255-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43411255-40.08966065-17.77478027 0-32.43493653 17.77478027-32.43493653 40.08966065v228.72875976c0 22.18469239 14.27124023 40.08883667 32.43493653 40.08883667z m117.41308594 0c17.7739563 0 32.43411255-17.7739563 32.43411255-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43411255-40.08966065-17.7739563 0-32.43493653 17.77478027-32.43493653 40.08966065v228.72875976c0 22.18469239 14.66098023 40.08883667 32.43493653 40.08883667z m123.51049804 0c17.7739563 0 32.43493653-17.7739563 32.43493652-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43493652-40.08966065-17.7739563 0-32.43411255 17.77478027-32.43411255 40.08966065v228.72875976c0 22.18469239 14.14105224 40.08883667 32.43411255 40.08883667z m0 0"  ></path></symbol><symbol id="icon-zijiedian" viewBox="0 0 1024 1024"><path d="M312.208 472c19.568-157.856 153.432-280 315.656-280 175.68 0 318.112 143.272 318.112 320S803.552 832 627.864 832c-162.224 0-296.08-122.144-315.656-280H120a40 40 0 0 1 0-80h192.208zM632 752c132.552 0 240-107.448 240-240 0-132.552-107.448-240-240-240-132.552 0-240 107.448-240 240 0 132.552 107.448 240 240 240z m-40-280v-80a40 40 0 0 1 80 0v80h80a40 40 0 0 1 0 80h-80v80a40 40 0 0 1-80 0v-80h-80a40 40 0 0 1 0-80h80z"  ></path></symbol><symbol id="icon-tongjijiedian-" viewBox="0 0 1024 1024"><path d="M803.84 131.626667H410.24A59.733333 59.733333 0 0 0 350.506667 192v45.226667H199.68a51.626667 51.626667 0 0 0-51.626667 51.626666v465.92a51.626667 51.626667 0 0 0 51.626667 51.626667h187.52v-55.466667h-162.133333a21.333333 21.333333 0 0 1-21.333334-21.333333V313.386667a21.333333 21.333333 0 0 1 21.333334-21.333334h125.653333v64a59.733333 59.733333 0 0 0 59.733333 59.733334h393.386667a59.733333 59.733333 0 0 0 59.733333-59.733334V192a59.733333 59.733333 0 0 0-59.733333-60.373333z m4.266667 224.64a4.266667 4.266667 0 0 1-4.266667 4.266666H410.24a4.266667 4.266667 0 0 1-4.266667-4.266666V192a4.266667 4.266667 0 0 1 4.266667-4.266667h393.6a4.266667 4.266667 0 0 1 4.266667 4.266667zM716.16 749.44h-81.28v-81.493333a27.733333 27.733333 0 0 0-55.466667 0v81.28h-81.493333a27.733333 27.733333 0 1 0 0 55.466666h81.28v81.28a27.733333 27.733333 0 1 0 55.466667 0v-81.066666h81.28a27.733333 27.733333 0 0 0 0-55.466667z"  ></path></symbol><symbol id="icon-close" viewBox="0 0 1024 1024"><path d="M557.312 513.248l265.28-263.904c12.544-12.48 12.608-32.704 0.128-45.248-12.512-12.576-32.704-12.608-45.248-0.128L512.128 467.904l-263.04-263.84c-12.448-12.48-32.704-12.544-45.248-0.064-12.512 12.48-12.544 32.736-0.064 45.28l262.976 263.776L201.6 776.8c-12.544 12.48-12.608 32.704-0.128 45.248a31.937 31.937 0 0 0 22.688 9.44c8.16 0 16.32-3.104 22.56-9.312l265.216-263.808 265.44 266.24c6.24 6.272 14.432 9.408 22.656 9.408a31.94 31.94 0 0 0 22.592-9.344c12.512-12.48 12.544-32.704 0.064-45.248L557.312 513.248z" fill="" ></path></symbol><symbol id="icon-menu" viewBox="0 0 1024 1024"><path d="M109.714 292.571h804.572c21.943 0 36.571-21.942 36.571-43.885 0-14.629-14.628-29.257-36.571-29.257H109.714c-21.943 0-36.571 14.628-36.571 36.571 0 14.629 14.628 36.571 36.571 36.571zM914.286 512H109.714c-21.943 0-36.571 14.629-36.571 36.571 0 14.629 14.628 36.572 36.571 36.572h804.572c21.943 0 36.571-21.943 36.571-43.886 0-14.628-14.628-29.257-36.571-29.257z m0 292.571H109.714c-21.943 0-36.571 14.629-36.571 36.572s14.628 36.571 36.571 36.571h804.572c21.943 0 36.571-21.943 36.571-36.571 0-21.943-14.628-36.572-36.571-36.572z"  ></path></symbol><symbol id="icon-right" viewBox="0 0 1024 1024"><path d="M385 560.69999999L385 738.9c0 36.90000001 26.4 68.5 61.3 68.5l150.2 0c1.5 0 3-0.1 4.5-0.3 10.2 38.7 45.5 67.3 87.5 67.3 50 0 90.5-40.5 90.5-90.5s-40.5-90.5-90.5-90.5c-42 0-77.3 28.6-87.5 67.39999999-1.4-0.3-2.9-0.4-4.5-0.39999999L446.3 760.4c-6.8 0-14.3-8.9-14.3-21.49999999l0-427.00000001c0-12.7 7.40000001-21.5 14.30000001-21.5l150.19999999 0c1.5 0 3-0.2 4.5-0.4 10.2 38.8 45.5 67.3 87.5 67.3 50 0 90.5-40.5 90.5-90.4 0-49.9-40.5-90.6-90.5-90.59999999-42 0-77.3 28.6-87.5 67.39999999-1.4-0.2-2.9-0.4-4.49999999-0.4L446.3 243.3c-34.80000001 0-61.3 31.6-61.3 68.50000001L385 513.7l-79.1 0c-10.4-38.5-45.49999999-67-87.4-67-50 0-90.5 40.5-90.5 90.5s40.5 90.5 90.5 90.5c41.79999999 0 77.00000001-28.4 87.4-67L385 560.69999999z" fill="#333333" ></path></symbol><symbol id="icon-left" viewBox="0 0 1024 1024"><path d="M639 463.30000001L639 285.1c0-36.90000001-26.4-68.5-61.3-68.5l-150.2 0c-1.5 0-3 0.1-4.5 0.3-10.2-38.7-45.5-67.3-87.5-67.3-50 0-90.5 40.5-90.5 90.5s40.5 90.5 90.5 90.5c42 0 77.3-28.6 87.5-67.39999999 1.4 0.3 2.9 0.4 4.5 0.39999999L577.7 263.6c6.8 0 14.3 8.9 14.3 21.49999999l0 427.00000001c0 12.7-7.40000001 21.5-14.30000001 21.5l-150.19999999 0c-1.5 0-3 0.2-4.5 0.4-10.2-38.8-45.5-67.3-87.5-67.3-50 0-90.5 40.5-90.5 90.4 0 49.9 40.5 90.6 90.5 90.59999999 42 0 77.3-28.6 87.5-67.39999999 1.4 0.2 2.9 0.4 4.49999999 0.4L577.7 780.7c34.80000001 0 61.3-31.6 61.3-68.50000001L639 510.3l79.1 0c10.4 38.5 45.49999999 67 87.4 67 50 0 90.5-40.5 90.5-90.5s-40.5-90.5-90.5-90.5c-41.79999999 0-77.00000001 28.4-87.4 67L639 463.30000001z" fill="#333333" ></path></symbol><symbol id="icon-side" viewBox="0 0 1024 1024"><path d="M851.91168 328.45312c-59.97056 0-108.6208 48.47104-108.91264 108.36992l-137.92768 38.4a109.14304 109.14304 0 0 0-63.46752-46.58688l1.39264-137.11872c47.29344-11.86816 82.31936-54.66624 82.31936-105.64096 0-60.15488-48.76288-108.91776-108.91776-108.91776s-108.91776 48.76288-108.91776 108.91776c0 49.18784 32.60928 90.75712 77.38368 104.27392l-1.41312 138.87488a109.19936 109.19936 0 0 0-63.50336 48.55808l-138.93632-39.48544 0.01024-0.72704c0-60.15488-48.76288-108.91776-108.91776-108.91776s-108.91776 48.75776-108.91776 108.91776c0 60.15488 48.76288 108.91264 108.91776 108.91264 39.3984 0 73.91232-20.92032 93.03552-52.2496l139.19232 39.552-0.00512 0.2304c0 25.8304 9.00096 49.5616 24.02816 68.23424l-90.14272 132.63872a108.7488 108.7488 0 0 0-34.2528-5.504c-60.15488 0-108.91776 48.768-108.91776 108.91776 0 60.16 48.76288 108.91776 108.91776 108.91776 60.16 0 108.92288-48.75776 108.92288-108.91776 0-27.14624-9.9328-51.968-26.36288-71.04l89.04704-131.03104a108.544 108.544 0 0 0 37.6832 6.70208 108.672 108.672 0 0 0 36.48512-6.272l93.13792 132.57216a108.48256 108.48256 0 0 0-24.69888 69.0688c0 60.16 48.768 108.92288 108.91776 108.92288 60.16 0 108.91776-48.76288 108.91776-108.92288 0-60.14976-48.75776-108.91776-108.91776-108.91776a108.80512 108.80512 0 0 0-36.69504 6.3488l-93.07136-132.48a108.48768 108.48768 0 0 0 24.79616-72.22784l136.09984-37.888c18.99008 31.93856 53.84192 53.3504 93.69088 53.3504 60.16 0 108.92288-48.75776 108.92288-108.91264-0.00512-60.15488-48.77312-108.92288-108.92288-108.92288z"  ></path></symbol><symbol id="icon-B" viewBox="0 0 1024 1024"><path d="M98.067692 65.457231H481.28c75.854769 0 132.411077 3.150769 169.668923 9.452307 37.336615 6.301538 70.656 19.534769 100.036923 39.620924 29.459692 20.007385 53.956923 46.710154 73.570462 80.029538 19.692308 33.398154 29.459692 70.734769 29.459692 112.167385 0 44.898462-12.130462 86.094769-36.233846 123.588923a224.886154 224.886154 0 0 1-98.461539 84.283077c58.368 17.092923 103.266462 46.08 134.695385 87.04 31.350154 40.96 47.025231 89.088 47.025231 144.462769 0 43.638154-10.082462 86.016-30.404923 127.212308-20.243692 41.196308-47.891692 74.043077-83.02277 98.697846-35.052308 24.654769-78.296615 39.778462-129.732923 45.449846-32.295385 3.465846-110.119385 5.671385-233.472 6.537846H98.067692V65.457231z m193.536 159.507692V446.621538h126.818462c75.460923 0 122.328615-1.024 140.603077-3.229538 33.083077-3.938462 59.155692-15.36 78.139077-34.343385 18.904615-18.904615 28.435692-43.874462 28.435692-74.830769 0-29.696-8.192-53.720615-24.497231-72.310154-16.384-18.510769-40.644923-29.696-72.940307-33.634461-19.140923-2.205538-74.279385-3.308308-165.415385-3.308308h-111.064615z m0 381.243077v256.315077h179.2c69.710769 0 113.979077-1.969231 132.726154-5.907692 28.750769-5.198769 52.145231-17.959385 70.262154-38.281847 18.116923-20.243692 27.096615-47.340308 27.096615-81.368615 0-28.750769-6.931692-53.169231-20.873846-73.255385a118.232615 118.232615 0 0 0-60.494769-43.795692c-26.387692-9.137231-83.574154-13.705846-171.638154-13.705846H291.603692z"  ></path></symbol><symbol id="icon-a" viewBox="0 0 1024 1024"><path d="M757.76 665.6q0 20.48 1.536 34.304t7.68 22.016 18.944 12.288 34.304 4.096q-3.072 25.6-15.36 44.032-11.264 16.384-33.28 29.696t-62.976 13.312q-11.264 0-20.48-0.512t-17.408-2.56l-6.144-2.048-1.024 0q-4.096-1.024-10.24-4.096-2.048-2.048-4.096-2.048-1.024-1.024-2.048-1.024-14.336-8.192-23.552-17.408t-14.336-17.408q-6.144-10.24-9.216-20.48-63.488 75.776-178.176 75.776-48.128 0-88.064-15.36t-69.12-44.032-45.056-68.096-15.872-88.576 16.896-89.088 47.616-67.584 74.24-42.496 96.768-14.848q48.128 0 88.576 17.408t66.048 49.152q0-8.192 0.512-16.384t0.512-15.36q0-71.68-39.936-104.448t-128-32.768q-43.008 0-84.992 6.656t-84.992 17.92q14.336-28.672 25.088-47.616t24.064-29.184q30.72-24.576 158.72-24.576 79.872 0 135.168 13.824t90.624 43.52 51.2 75.264 15.872 108.032l0 200.704zM487.424 743.424q50.176 0 79.872-33.28t29.696-95.744q0-61.44-28.672-93.696t-76.8-32.256q-52.224 0-82.944 33.28t-30.72 94.72q0 58.368 31.744 92.672t77.824 34.304z"  ></path></symbol><symbol id="icon-full" viewBox="0 0 1024 1024"><path d="M639.328 416c8.032 0 16.096-3.008 22.304-9.056l202.624-197.184-0.8 143.808c-0.096 17.696 14.144 32.096 31.808 32.192 0.064 0 0.128 0 0.192 0 17.6 0 31.904-14.208 32-31.808l1.248-222.208c0-0.672-0.352-1.248-0.384-1.92 0.032-0.512 0.288-0.896 0.288-1.408 0.032-17.664-14.272-32-31.968-32.032L671.552 96l-0.032 0c-17.664 0-31.968 14.304-32 31.968C639.488 145.632 653.824 160 671.488 160l151.872 0.224-206.368 200.8c-12.672 12.32-12.928 32.608-0.64 45.248C622.656 412.736 630.976 416 639.328 416z"  ></path><path d="M896.032 639.552 896.032 639.552c-17.696 0-32 14.304-32.032 31.968l-0.224 151.872-200.832-206.4c-12.32-12.64-32.576-12.96-45.248-0.64-12.672 12.352-12.928 32.608-0.64 45.248l197.184 202.624-143.808-0.8c-0.064 0-0.128 0-0.192 0-17.6 0-31.904 14.208-32 31.808-0.096 17.696 14.144 32.096 31.808 32.192l222.24 1.248c0.064 0 0.128 0 0.192 0 0.64 0 1.12-0.32 1.76-0.352 0.512 0.032 0.896 0.288 1.408 0.288l0.032 0c17.664 0 31.968-14.304 32-31.968L928 671.584C928.032 653.952 913.728 639.584 896.032 639.552z"  ></path><path d="M209.76 159.744l143.808 0.8c0.064 0 0.128 0 0.192 0 17.6 0 31.904-14.208 32-31.808 0.096-17.696-14.144-32.096-31.808-32.192L131.68 95.328c-0.064 0-0.128 0-0.192 0-0.672 0-1.248 0.352-1.888 0.384-0.448 0-0.8-0.256-1.248-0.256 0 0-0.032 0-0.032 0-17.664 0-31.968 14.304-32 31.968L96 352.448c-0.032 17.664 14.272 32 31.968 32.032 0 0 0.032 0 0.032 0 17.664 0 31.968-14.304 32-31.968l0.224-151.936 200.832 206.4c6.272 6.464 14.624 9.696 22.944 9.696 8.032 0 16.096-3.008 22.304-9.056 12.672-12.32 12.96-32.608 0.64-45.248L209.76 159.744z"  ></path><path d="M362.368 617.056l-202.624 197.184 0.8-143.808c0.096-17.696-14.144-32.096-31.808-32.192-0.064 0-0.128 0-0.192 0-17.6 0-31.904 14.208-32 31.808l-1.248 222.24c0 0.704 0.352 1.312 0.384 2.016 0 0.448-0.256 0.832-0.256 1.312-0.032 17.664 14.272 32 31.968 32.032L352.448 928c0 0 0.032 0 0.032 0 17.664 0 31.968-14.304 32-31.968s-14.272-32-31.968-32.032l-151.936-0.224 206.4-200.832c12.672-12.352 12.96-32.608 0.64-45.248S375.008 604.704 362.368 617.056z"  ></path></symbol><symbol id="icon-add" viewBox="0 0 1024 1024"><path d="M863.328 482.56l-317.344-1.12L545.984 162.816c0-17.664-14.336-32-32-32s-32 14.336-32 32l0 318.4L159.616 480.064c-0.032 0-0.064 0-0.096 0-17.632 0-31.936 14.24-32 31.904C127.424 529.632 141.728 544 159.392 544.064l322.592 1.152 0 319.168c0 17.696 14.336 32 32 32s32-14.304 32-32l0-318.944 317.088 1.12c0.064 0 0.096 0 0.128 0 17.632 0 31.936-14.24 32-31.904C895.264 496.992 880.96 482.624 863.328 482.56z"  ></path></symbol><symbol id="icon-move" viewBox="0 0 1024 1024"><path d="M863.744 544 163.424 544c-17.664 0-32-14.336-32-32s14.336-32 32-32l700.32 0c17.696 0 32 14.336 32 32S881.44 544 863.744 544z"  ></path></symbol><symbol id="icon-living" viewBox="0 0 1024 1024"><path d="M514.133333 488.533333m-106.666666 0a106.666667 106.666667 0 1 0 213.333333 0 106.666667 106.666667 0 1 0-213.333333 0Z" fill="#666666" ></path><path d="M512 64C264.533333 64 64 264.533333 64 512c0 236.8 183.466667 428.8 416 445.866667v-134.4c-53.333333-59.733333-200.533333-230.4-200.533333-334.933334 0-130.133333 104.533333-234.666667 234.666666-234.666666s234.666667 104.533333 234.666667 234.666666c0 61.866667-49.066667 153.6-145.066667 270.933334l-59.733333 68.266666V960C776.533333 942.933333 960 748.8 960 512c0-247.466667-200.533333-448-448-448z" fill="#666666" ></path></symbol></svg>',r=(r=document.getElementsByTagName("script"))[r.length-1].getAttribute("data-injectcss");if(r&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(m){console&&console.log(m)}}function g(){o||(o=!0,i())}t=function(){var m,v,a,N;(N=document.createElement("div")).innerHTML=c,c=null,(a=N.getElementsByTagName("svg")[0])&&(a.setAttribute("aria-hidden","true"),a.style.position="absolute",a.style.width=0,a.style.height=0,a.style.overflow="hidden",m=a,(v=document.body).firstChild?(N=m,(a=v.firstChild).parentNode.insertBefore(N,a)):v.appendChild(m))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(t,0):(n=function(){document.removeEventListener("DOMContentLoaded",n,!1),t()},document.addEventListener("DOMContentLoaded",n,!1)):document.attachEvent&&(i=t,s=e.document,o=!1,(l=function(){try{s.documentElement.doScroll("left")}catch{return void setTimeout(l,50)}g()})(),s.onreadystatechange=function(){s.readyState=="complete"&&(s.onreadystatechange=null,g())})})(window);const H=E,R=document;function M({el:e,direction:t,locale:n,draggable:i,editable:s,contextMenu:o,contextMenuOption:l,toolBar:c,nodeMenu:r,keypress:g,before:m,newTopicName:v,allowUndo:a,primaryLinkStyle:N,overflowHidden:p,primaryNodeHorizontalGap:y,primaryNodeVerticalGap:b,mobileMenu:h}){console.log("ME_version "+M.version,this);let f;const d=Object.prototype.toString.call(e);if(d==="[object HTMLDivElement]"?f=e:d==="[object String]"&&(f=document.querySelector(e)),!f)return new Error("MindElixir: el is not a valid element");this.mindElixirBox=f,this.before=m||{},this.locale=n,this.contextMenuOption=l,this.contextMenu=o===void 0?!0:o,this.toolBar=c===void 0?!0:c,this.nodeMenu=r===void 0?!0:r,this.keypress=g===void 0?!0:g,this.mobileMenu=h,this.direction=typeof t=="number"?t:1,this.draggable=i===void 0?!0:i,this.newTopicName=v,this.editable=s===void 0?!0:s,this.allowUndo=a===void 0?!0:a,this.currentNode=null,this.currentLink=null,this.inputDiv=null,this.scaleVal=1,this.tempDirection=null,this.primaryLinkStyle=N||0,this.overflowHidden=p,this.primaryNodeHorizontalGap=y,this.primaryNodeVerticalGap=b,this.bus=new ce,this.bus.addListener("operation",u=>{if(this.isUndo){this.isUndo=!1;return}["moveNode","removeNode","addChild","finishEdit","editStyle","editTags","editIcons"].includes(u.name)&&this.history.push(u)}),this.history=[],this.isUndo=!1,this.undo=function(){const u=this.history.pop();u&&(this.isUndo=!0,u.name==="moveNode"?this.moveNode(H(u.obj.fromObj.id),H(u.obj.originParentId)):u.name==="removeNode"?u.originSiblingId?this.insertBefore(H(u.originSiblingId),u.obj):this.addChild(H(u.originParentId),u.obj):u.name==="addChild"||u.name==="copyNode"?this.removeNode(H(u.obj.id)):u.name==="finishEdit"?this.setNodeTopic(H(u.obj.id),u.origin):this.isUndo=!1)},this.mindElixirBox.className+=" mind-elixir",this.mindElixirBox.innerHTML="",this.container=R.createElement("div"),this.container.className="map-container",this.map=R.createElement("div"),this.map.className="map-canvas",this.map.setAttribute("tabindex","0"),this.container.appendChild(this.map),this.mindElixirBox.appendChild(this.container),this.root=R.createElement("root"),this.box=R.createElement("children"),this.box.className="box",this.svg2nd=q("svg2nd"),this.linkController=q("linkcontroller"),this.P2=R.createElement("div"),this.P3=R.createElement("div"),this.P2.className=this.P3.className="circle",this.line1=ee(0,0,0,0),this.line2=ee(0,0,0,0),this.linkController.appendChild(this.line1),this.linkController.appendChild(this.line2),this.linkSvgGroup=q("topiclinks"),this.map.appendChild(this.root),this.map.appendChild(this.box),this.map.appendChild(this.svg2nd),this.map.appendChild(this.linkController),this.map.appendChild(this.linkSvgGroup),this.map.appendChild(this.P2),this.map.appendChild(this.P3),this.overflowHidden?this.container.style.overflow="hidden":Ct(this)}function L(e){return async function(...t){(!this.before[e.name]||await this.before[e.name].apply(this,t))&&e.apply(this,t)}}M.prototype={addParentLink:w,getObjById:ie,generateNewObj:he,insertSibling:L(nt),insertBefore:L(it),insertParent:L(st),addChild:L(ot),copyNode:L(lt),moveNode:L(dt),removeNode:L(at),moveUpNode:L(rt),moveDownNode:L(ct),beginEdit:L(ft),moveNodeBefore:L(ht),moveNodeAfter:L(ut),updateNodeStyle:Ze,updateNodeTags:Qe,updateNodeIcons:et,updateNodeHyperLink:tt,processPrimaryNode:mt,setNodeTopic:pt,createLink:gt,removeLink:Nt,selectLink:bt,hideLinkController:vt,showLinkController:yt,layout:we,linkDiv:xt,createInputDiv:Le,createChildren:$e,createGroup:xe,createTop:Ce,createTopic:ke,selectNode:Oe,unselectNode:Pe,selectNextSibling:De,selectPrevSibling:Ae,selectFirstChild:He,selectParent:Re,getAllDataString:Ie,getAllData:ze,getAllDataMd:Be,scale:Ve,toCenter:Ue,focusNode:qe,cancelFocus:Ge,initLeft:Fe,initRight:Ye,initSide:We,setLocale:Xe,enableEdit:je,disableEdit:_e,expandNode:Ke,refresh:Je,install(e){e(this)},init(e){if(!e||!e.nodeData)return new Error("MindElixir: `data` is required");this.nodeData=e.nodeData,this.linkData=e.linkData||{},this.toolBar&&$t(this),this.nodeMenu&&Tt(this),this.keypress&&Ot(this),ae()&&this.mobileMenu?Pt(this):this.contextMenu&&kt(this,this.contextMenuOption),this.draggable&&Mt(this),w(this.nodeData),this.toCenter(),this.layout(),this.linkDiv()}};M.LEFT=0;M.RIGHT=1;M.SIDE=2;M.version="1.0.0";M.E=E;M.new=e=>({nodeData:{id:F(),topic:e||"new topic",root:!0,children:[]},linkData:{}});export{H as E,M as default};
